<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <title>Weighted CGPA Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light text-dark">

<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="fw-bold text-primary">üéì Weighted CGPA Calculator</h2>
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="themeToggle">
            <label class="form-check-label" for="themeToggle">üåô Dark Mode</label>
        </div>
    </div>

    <div class="bg-body-tertiary p-5 rounded shadow-lg">
        <div class="mb-3">
            <label for="numSemesters" class="form-label">Number of Semesters</label>
            <input type="number" id="numSemesters" class="form-control" placeholder="e.g., 8">
        </div>
        <div class="d-grid mb-4">
            <button class="btn btn-primary" onclick="generateInputs()">Generate</button>
        </div>

        <form id="semestersForm"></form>

        <div class="d-grid mt-3">
            <button class="btn btn-success" onclick="calculateCGPA()">Calculate CGPA</button>
        </div>

        <div id="result" class="mt-4 fs-5 fw-bold text-center"></div>
    </div>
</div>

<script>
    // üåû Default Light Mode, Toggle to Dark
    const htmlEl = document.documentElement;
    const toggle = document.getElementById('themeToggle');
    const bodyEl = document.body;

    const userPref = localStorage.getItem('theme');

    if (userPref === 'dark') {
        htmlEl.setAttribute('data-bs-theme', 'dark');
        bodyEl.classList.replace('bg-light', 'bg-dark');
        bodyEl.classList.replace('text-dark', 'text-light');
        toggle.checked = true;
    } else {
        htmlEl.setAttribute('data-bs-theme', 'light');
        bodyEl.classList.replace('bg-dark', 'bg-light');
        bodyEl.classList.replace('text-light', 'text-dark');
        toggle.checked = false;
    }

    toggle.addEventListener('change', () => {
        const isDark = toggle.checked;
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        htmlEl.setAttribute('data-bs-theme', isDark ? 'dark' : 'light');
        bodyEl.classList.toggle('bg-dark', isDark);
        bodyEl.classList.toggle('text-light', isDark);
        bodyEl.classList.toggle('bg-light', !isDark);
        bodyEl.classList.toggle('text-dark', !isDark);
    });

    // üßÆ GPA Logic
    function generateInputs() {
        const num = parseInt(document.getElementById("numSemesters").value);
        const form = document.getElementById("semestersForm");
        form.innerHTML = "";

        for (let i = 1; i <= num; i++) {
            const row = document.createElement("div");
            row.className = "row g-3 align-items-center mb-3";

            row.innerHTML = `
                <div class="col-md-6">
                    <label>Semester ${i} GPA</label>
                    <input type="number" step="0.01" class="form-control gpa" placeholder="e.g., 3.5">
                </div>
                <div class="col-md-6">
                    <label>Credit Hours</label>
                    <input type="number" class="form-control credit" placeholder="e.g., 18">
                </div>
            `;
            form.appendChild(row);
        }
    }

    async function calculateCGPA() {
        const gpaInputs = document.querySelectorAll(".gpa");
        const creditInputs = document.querySelectorAll(".credit");
        const semesters = [];

        for (let i = 0; i < gpaInputs.length; i++) {
            const gpa = parseFloat(gpaInputs[i].value);
            const credit = parseFloat(creditInputs[i].value);

            if (isNaN(gpa) || isNaN(credit)) {
                document.getElementById("result").innerHTML = `<div class="alert alert-danger">Please fill all GPA and Credit Hour fields</div>`;
                return;
            }

            semesters.push({ gpa, credit });
        }

        const response = await fetch("/calculate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ semesters })
        });

        const data = await response.json();
        const result = document.getElementById("result");

        if (data.cgpa) {
            result.innerHTML = `<div class="alert alert-success">‚úÖ Your CGPA is: <strong>${data.cgpa}</strong></div>`;
        } else {
            result.innerHTML = `<div class="alert alert-danger">‚ùå ${data.error}</div>`;
        }
    }
</script>

</body>
</html>